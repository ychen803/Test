<?xml version="1.0"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
  http://go.microsoft.com/fwlink/?LinkId=301880
  -->
<configuration>
  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,Log4net" requirePermission="false"/>
    <!--Elmah configuration sections-->
    <sectionGroup name="elmah">
      <section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah"/>
      <section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah"/>
    </sectionGroup>
    <!--SIM Client configuration sections-->
    <section name="samlServiceProvider" type="NCS.SecureConnect.SIM.Configurations.SettingConfiguration, NCS.SecureConnect.SIM.Configurations"/>
  </configSections>
  <log4net configSource="Log4Net.config"/>
  <connectionStrings>
    <!--Elmah SQLite SQLite DB for error and info logs-->
    <add name="Elmah.SQLite" connectionString="data source=~/App_Data/ClientLog.db"/>
  </connectionStrings>
  <samlServiceProvider>
    <settings>
      <!--Trigger URLs-->
      <setting name="singPassTriggerUrl" value="https://sso-stg.police.gov.sg:443/spfsso/profile/SAML2/Unsolicited/SSO?providerId=http%3a%2f%2flocal.simclient.test%2f&amp;shire=http%3A%2F%2Flocalhost%3A8080%2FSingPassAssertionConsumerService.ashx"/>
      <setting name="corpPassTriggerUrl" value="https://spcp.ncs.com:9443/corppass/profile/SAML2/Unsolicited/SSO?providerId=http%3a%2f%2flocal.simclient.test%2f&amp;shire=http%3A%2F%2Flocalhost%3A8080%2FCorpPassAssertionConsumerService.ashx"/>
      <!-- SIM Client Settings -->
      <setting name="ServiceProviderEntityId" value="http://local.simclient.test/"/>
      <setting name="SPInitiatedLogoutRequestBinding" value="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"/>
      <!-- Proxy Settings :not using -->
      <setting name="ProxyEnabled" value="false"/>
      <setting name="ProxyHost" value="proxy.ncs.com.sg"/>
      <setting name="ProxyPort" value="8080"/>
      <setting name="ProxyUsername" value="xxxx"/>
      <setting name="ProxyPassword" value="xxxx"/>
      <!-- Common Settings -->
      <setting name="defaultLandingPage" value="https://localhost:8080/Home"/>
      <setting name="defaultLogoutLandingPage" value="http://www.police.gov.sg"/>
      <setting name="SetAuthCookieOnSuccess" value="true"/>
      <setting name="TestMode" value="false"/>
      <!-- Logger Settings -->
      <!--Possible values are Off | Error | Warning | Info | Debug-->
      <setting name="LogLevel" value="Debug"/>
      <!--Possible values are NCS.SecureConnect.SIM.Logging.LogProviders.ElmahLogProvider | TextLogProvider | EventLogProvider-->
      <setting name="LogProvider" value="NCS.SecureConnect.SIM.Logging.LogProviders.ElmahLogProvider"/>
      <setting name="LogFolder" value="~/App_Data/Logs"/>
      <setting name="LogSource" value="SecureConnect SIM"/>
      <!-- Keep-Alive Settings -->
      <setting name="KeepAliveEnabled" value="false"/>
      <setting name="KeepAliveNotifyingInterval" value="1"/>
      <setting name="KeepAliveSingPassUrl" value="http://172.24.52.130:8080/spfsso/keepalive"/>
      <setting name="KeepAliveCorpPassUrl" value="http://csp.ncs.com:7070/cpcspsso/keepalive"/>
      <setting name="KeepAliveNameIdFormat" value="urn:oasis:names:tc:SAML:2.0:nameid-format:transient"/>
    </settings>
  </samlServiceProvider>
  <!--Elmah Configuration section-->
  <elmah>
    <security allowRemoteAccess="0"/>
    <errorLog type="Elmah.SQLiteErrorLog, Elmah" connectionStringName="Elmah.SQLite"/>
  </elmah>
  <appSettings>
    <add key="webpages:Version" value="3.0.0.0"/>
    <add key="webpages:Enabled" value="false"/>
    <add key="ClientValidationEnabled" value="true"/>
    <add key="UnobtrusiveJavaScriptEnabled" value="true"/>
    <add key="BaseServicesURL" value="http://localhost:7379/"/>
    <add key="WarrantServiceURL" value="WarrantService.svc/Warrant/"/>
    <add key="UpdateStatusURL" value="WarrantService.svc/LastUpdate"/>
    <add key="LogServiceURL" value="LogService.svc/Log/"/>
    <add key="aspnet:FormsAuthReturnUrlVar" value="target"/>
  </appSettings>
  <system.web>
    <compilation debug="true" targetFramework="4.5"/>
    <httpRuntime targetFramework="4.5"/>
    <customErrors mode="Off" defaultRedirect="~/Error/Index">
      <error statusCode="404" redirect="~/Error/NotFound"/>
    </customErrors>
    <!-- Turn off IIS Authentication -->
    <!--<authentication mode="None" />-->
    <!--Authentication mode should be Forms-->
    <authentication mode="Forms">
      <forms loginUrl="https://sso-stg.police.gov.sg:443/spfsso/profile/SAML2/Unsolicited/SSO?providerId=http%3a%2f%2flocal.simclient.test%2f&amp;shire=http%3A%2F%2Flocalhost%3A8080%2FSingPassAssertionConsumerService.ashx"/>
    </authentication>
  </system.web>
  <!--http://stackoverflow.com/questions/1545864/how-to-enable-and-disable-elmah-in-web-config-and-in-code-behind-->
  <system.webServer>
    
      <httpErrors errorMode="Custom" existingResponse="Replace">
        <clear />
        <error statusCode="400" responseMode="ExecuteURL" path="/Error/Index" />
        <error statusCode="403" responseMode="ExecuteURL" path="/Error/NotFound" />
        <error statusCode="404" responseMode="ExecuteURL" path="/Error/NotFound" />
        <error statusCode="500" responseMode="ExecuteURL" path="/Error/Index" />
      </httpErrors>
    
    <!--IIS 7 integration mode & above-->
    <modules runAllManagedModulesForAllRequests="true">
      <!--Optional: Module which redirects unauthenticated requests to SingPass login page automatically. If using SIM Client API do not need to include this-->
      <!--<add name="UnauthenticatedRequestInterceptorModule" type="NCS.SecureConnect.SIM.Common.UnauthenticatedRequestInterceptorModule, NCS.SecureConnect.SIM.Common"/>-->
      <!--Enable Elmah modules-->
      <add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" preCondition="managedHandler"/>
      <add name="KeppAlive" type="NCS.SecureConnect.SIM.Client.HttpModules.KeepAliveModule, NCS.SecureConnect.SIM.Client" preCondition="managedHandler"/>
    </modules>
    <handlers>
      <!--Endpoint to view Elmah logs online-->
      <add name="Elmah" path="elmah.axd" verb="POST,GET,HEAD" type="Elmah.ErrorLogPageFactory, Elmah" preCondition="integratedMode"/>
      <!--AssertionConsumerService endpoint to SingPass by SIM Client-->
      <add name="SingPassAssertionConsumerService" verb="*" path="SingPassAssertionConsumerService.ashx" type="NCS.SecureConnect.SIM.Client.HttpHandlers.SingPassAssertionConsumerService, NCS.SecureConnect.SIM.Client" resourceType="Unspecified"/>
      <!--SingleLogoutService endpoint to SingPass by SIM Client-->
      <add name="SingPassSingleLogoutService" verb="*" path="SingPassSingleLogoutService.ashx" type="NCS.SecureConnect.SIM.Client.HttpHandlers.SingPassSingleLogoutService, NCS.SecureConnect.SIM.Client" resourceType="Unspecified"/>
      <!--AssertionConsumerService endpoint to CorpPass by SIM Client-->
      <add name="CorpPassAssertionConsumerService" verb="*" path="CorpPassAssertionConsumerService.ashx" type="NCS.SecureConnect.SIM.Client.HttpHandlers.CorpPassAssertionConsumerService, NCS.SecureConnect.SIM.Client" resourceType="Unspecified"/>
      <!--SingleLogoutService endpoint to CorpPass by SIM Client-->
      <add name="CorpPassSingleLogoutService" verb="*" path="CorpPassSingleLogoutService.ashx" type="NCS.SecureConnect.SIM.Client.HttpHandlers.CorpPassSingleLogoutService, NCS.SecureConnect.SIM.Client" resourceType="Unspecified"/>
    </handlers>

    <httpProtocol>
      <customHeaders>
        <add name="X-Frame-Options" value="DENY" />
        <add name="Cache-Control" value="no-store"/>
      </customHeaders>
    </httpProtocol>
    
  </system.webServer>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="System.Data.SQLite" publicKeyToken="db937bc2d44ff139" culture="neutral"/>
        <bindingRedirect oldVersion="0.0.0.0-1.0.97.0" newVersion="1.0.97.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Newtonsoft.Json" culture="neutral" publicKeyToken="30ad4fe6b2a6aeed"/>
        <bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Optimization" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="1.1.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="WebGrease" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="0.0.0.0-1.5.2.14234" newVersion="1.5.2.14234"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Helpers" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-5.2.2.0" newVersion="5.2.2.0"/>
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration>